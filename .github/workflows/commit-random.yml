name: keep github-green 

on:
  schedule:
    # 每天北京时间 10:15, 15:15, 21:15 触发
    - cron: '15 2,7,13 * * *' 
  workflow_dispatch: {}

permissions:
  contents: write

jobs:
  randomized-commits:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          [cite_start]fetch-depth: 0 # 保持完整的 git 历史以确保提交正常 

      - name: Run human-like commit generator
        env:
          # 核心认证信息
          [cite_start]REPO: ${{ github.repository }} [cite: 3]
          [cite_start]GITHUB_ACTOR: ${{ github.actor }} [cite: 3]
          [cite_start]ACTOR_NAME: ${{ secrets.ACTOR_NAME }} [cite: 3]
          [cite_start]ACTOR_EMAIL: ${{ secrets.ACTOR_EMAIL }} [cite: 3]
          [cite_start]PUSH_TOKEN: ${{ secrets.PUSH_TOKEN }} [cite: 3]
          
          # 频率与概率控制
          [cite_start]SKIP_PROB: "0.1"               # 对应脚本中的 skip_prob，10% 概率跳过当天 
          [cite_start]MAX_COMMITS: "3"              # 每次运行最多提交 3 次 
          
          # 时长压缩控制（这是省钱的关键）
          [cite_start]MIN_SLEEP: "5"                # 提交之间的随机睡眠最小秒数 
          [cite_start]MAX_SLEEP: "15"               # 提交之间的随机睡眠最大秒数（原 120s 缩减至 15s） 
          [cite_start]MAX_START_DELAY_MINUTES: "1"  # 启动前随机延迟（原 60min 缩减至 1min，防止虚拟机空转计费） 
          
        run: |
          chmod +x .github/scripts/random_commit.py
          python3 .github/scripts/random_commit.py
